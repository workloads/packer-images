# frozen_string_literal: true

# see https://www.vagrantup.com/docs/vagrantfile/vagrant_version
Vagrant.require_version '>= 2.3.0'

# see https://www.vagrantup.com/docs/vagrantfile/machine_settings
# and https://www.vagrantup.com/docs/vagrantfile/ssh_settings
Vagrant.configure(2) do |cfg|
  cfg.vm.communicator     = 'ssh'
  cfg.vm.hostname         = '{{ .BoxName }}'
  cfg.ssh.forward_agent   = true
  cfg.ssh.insert_key      = {{ .InsertKey }}
  cfg.ssh.keys_only       = true

  # Source Vagrant Box
  cfg.vm.define 'source', autostart: false do |source|
    source.vm.box = '{{ .SourceBox }}'
  end

  # Packer-built Output Vagrant Box
  cfg.vm.define 'output' do |output|
    output.vm.box     = '{{ .BoxName }}'
    output.vm.box_url = 'file://package.box'
  end

  # TODO: add private and public networking

  # TODO: add support for port-forwarding (see #10)

{{ if ne .SyncedFolder "" -}}
  # see https://www.vagrantup.com/docs/synced-folders/basic_usage
  cfg.vm.synced_folder '{{ .SyncedFolder }}', '/vagrant'
{{- else -}}
  cfg.vm.synced_folder '.', '/vagrant', disabled: true
{{- end}}

  # see https://www.vagrantup.com/docs/providers/virtualbox/configuration
  cfg.vm.provider 'virtualbox' do |v|
    v.check_guest_additions = false
    v.cpus                  = 2
    v.gui                   = false
    v.memory                = 4096
    v.name                  = '{{ .BoxName }}'
  end
end
